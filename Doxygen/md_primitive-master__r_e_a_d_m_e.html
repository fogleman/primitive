<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Primitive Pictures</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_primitive-master__r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Primitive Pictures </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Reproducing images with geometric primitives.</p>
<p><img src="https://www.michaelfogleman.com/static/primitive/examples/16550611738.200.128.4.5.png" alt="Example" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md1"></a>
How it Works</h2>
<p>A target image is provided as input. The algorithm tries to find the single most optimal shape that can be drawn to minimize the error between the target image and the drawn image. It repeats this process, adding <em>one shape at a time</em>. Around 50 to 200 shapes are needed to reach a result that is recognizable yet artistic and abstract.</p>
<h2><a class="anchor" id="autotoc_md2"></a>
Primitive for macOS</h2>
<p>Now available as a native Mac application!</p>
<p><a href="https://primitive.lol/">https://primitive.lol/</a></p>
<h2><a class="anchor" id="autotoc_md3"></a>
Twitter</h2>
<p>Follow <a href="https://twitter.com/PrimitivePic">@PrimitivePic</a> on Twitter to see a new primitive picture every 30 minutes!</p>
<p>The Twitter bot looks for interesting photos using the Flickr API, runs the algorithm using randomized parameters, and posts the picture using the Twitter API.</p>
<p>You can tweet a picture to the bot and it will process it for you.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Command-line Usage</h2>
<p>Run it on your own images! First, <a href="https://golang.org/doc/install">install Go</a>. </p><pre class="fragment">go get -u github.com/fogleman/primitive
primitive -i input.png -o output.png -n 100
</pre><p>Small input images should be used (like 256x256px). You don't need the detail anyway and the code will run faster.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Flag </th><th class="markdownTableHeadNone">Default </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>i</code> </td><td class="markdownTableBodyNone">n/a </td><td class="markdownTableBodyNone">input file  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>o</code> </td><td class="markdownTableBodyNone">n/a </td><td class="markdownTableBodyNone">output file  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>n</code> </td><td class="markdownTableBodyNone">n/a </td><td class="markdownTableBodyNone">number of shapes  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>m</code> </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">mode: 0=combo, 1=triangle, 2=rect, 3=ellipse, 4=circle, 5=rotatedrect, 6=beziers, 7=rotatedellipse, 8=polygon  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>rep</code> </td><td class="markdownTableBodyNone">0 </td><td class="markdownTableBodyNone">add N extra shapes each iteration with reduced search (mostly good for beziers)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>nth</code> </td><td class="markdownTableBodyNone">1 </td><td class="markdownTableBodyNone">save every Nth frame (only when <code>d</code> is in output path)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>r</code> </td><td class="markdownTableBodyNone">256 </td><td class="markdownTableBodyNone">resize large input images to this size before processing  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>s</code> </td><td class="markdownTableBodyNone">1024 </td><td class="markdownTableBodyNone">output image size  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>a</code> </td><td class="markdownTableBodyNone">128 </td><td class="markdownTableBodyNone">color alpha (use <code>0</code> to let the algorithm choose alpha for each shape)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>bg</code> </td><td class="markdownTableBodyNone">avg </td><td class="markdownTableBodyNone">starting background color (hex)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>j</code> </td><td class="markdownTableBodyNone">0 </td><td class="markdownTableBodyNone">number of parallel workers (default uses all cores)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>v</code> </td><td class="markdownTableBodyNone">off </td><td class="markdownTableBodyNone">verbose output  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>vv</code> </td><td class="markdownTableBodyNone">off </td><td class="markdownTableBodyNone">very verbose output  </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md5"></a>
Output Formats</h2>
<p>Depending on the output filename extension provided, you can produce different types of output.</p>
<ul>
<li><code>PNG</code>: raster output</li>
<li><code>JPG</code>: raster output</li>
<li><code>SVG</code>: vector output</li>
<li><code>GIF</code>: animated output showing shapes being added - requires ImageMagick (specifically the <code>convert</code> command)</li>
</ul>
<p>For PNG and SVG outputs, you can also include <code>d</code>, <code>%03d</code>, etc. in the filename. In this case, each frame will be saved separately.</p>
<p>You can use the <code>-o</code> flag multiple times. This way you can save both a PNG and an SVG, for example.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Progression</h2>
<p>This GIF demonstrates the iterative nature of the algorithm, attempting to minimize the mean squared error by adding one shape at a time. (Use a ".gif" output file to generate one yourself!)</p>
<p><img src="https://www.michaelfogleman.com/static/primitive/examples/monalisa.3.2000.gif" alt="" width="440" class="inline"/> <img src="https://www.michaelfogleman.com/static/primitive/examples/monalisa-original.png" alt="" width="440" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md7"></a>
Static Animation</h2>
<p>Since the algorithm has a random component to it, you can run it against the same input image multiple times to bring life to a static image.</p>
<p><img src="https://www.michaelfogleman.com/static/primitive/examples/pencils.gif" alt="Pencils" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md8"></a>
Creative Constraints</h2>
<p>If you're willing to dabble in the code, you can enforce constraints on the shapes to produce even more interesting results. Here, the rectangles are constrained to point toward the sun in this picture of a pyramid sunset.</p>
<p><img src="https://www.michaelfogleman.com/static/primitive/examples/pyramids.png" alt="Pyramids" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md9"></a>
Shape and Iteration Comparison Matrix</h2>
<p>The matrix below shows triangles, ellipses and rectangles at 50, 100 and 200 iterations each.</p>
<p><img src="http://i.imgur.com/H5NYpL4.png" alt="Matrix" class="inline"/></p>
<h2><a class="anchor" id="autotoc_md10"></a>
How it Works, Part II</h2>
<p>Say we have a <code>Target Image</code>. This is what we're working towards recreating. We start with a blank canvas, but we fill it with a single solid color. Currently, this is the average color of the <code>Target Image</code>. We call this new blank canvas the <code>Current Image</code>. Now, we start evaluating shapes. To evaluate a shape, we draw it on top of the <code>Current Image</code>, producing a <code>New Image</code>. This <code>New Image</code> is compared to the <code>Target Image</code> to compute a score. We use the <a href="https://en.wikipedia.org/wiki/Root-mean-square_deviation">root-mean-square error</a> for the score. </p><pre class="fragment">Current Image + Shape =&gt; New Image
RMSE(New Image, Target Image) =&gt; Score
</pre><p>The shapes are generated randomly. We can generate a random shape and score it. Then we can mutate the shape (by tweaking a triangle vertex, tweaking an ellipse radius or center, etc.) and score it again. If the mutation improved the score, we keep it. Otherwise we rollback to the previous state. Repeating this process is known as <a href="https://en.wikipedia.org/wiki/Hill_climbing">hill climbing</a>. Hill climbing is prone to getting stuck in local minima, so we actually do this many different times with several different starting shapes. We can also generate N random shapes and pick the best one before we start hill climbing. <a href="https://en.wikipedia.org/wiki/Simulated_annealing">Simulated annealing</a> is another good option, but in my tests I found the hill climbing technique just as good and faster, at least for this particular problem.</p>
<p>Once we have found a good-scoring shape, we add it to the <code>Current Image</code>, where it will remain unchanged. Then we start the process again to find the next shape to draw. This process is repeated as many times as desired.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Primitives</h2>
<p>The following primitives are supported:</p>
<ul>
<li>Triangle</li>
<li>Rectangle (axis-aligned)</li>
<li>Ellipse (axis-aligned)</li>
<li>Circle</li>
<li>Rotated Rectangle</li>
<li>Combo (a mix of the above in a single image)</li>
</ul>
<p>More shapes can be added by implementing the following interface:</p>
<div class="fragment"><div class="line">type Shape interface {</div>
<div class="line">    Rasterize() []Scanline</div>
<div class="line">    Copy() Shape</div>
<div class="line">    Mutate()</div>
<div class="line">    Draw(dc *gg.Context)</div>
<div class="line">    SVG(attrs string) string</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md12"></a>
Features</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Hill_climbing">Hill Climbing</a> or <a href="https://en.wikipedia.org/wiki/Simulated_annealing">Simulated Annealing</a> for optimization (hill climbing multiple random shapes is nearly as good as annealing and faster)</li>
<li>Scanline rasterization of shapes in pure Go (preferable for implementing the features below)</li>
<li>Optimal color computation based on affected pixels for each shape (color is directly computed, not optimized for)</li>
<li>Partial image difference for faster scoring (only pixels that change need be considered)</li>
<li>Anti-aliased output rendering</li>
</ul>
<h2><a class="anchor" id="autotoc_md13"></a>
Inspiration</h2>
<p>This project was originally inspired by the popular and excellent work of Roger Johansson - <a href="https://rogeralsing.com/2008/12/07/genetic-programming-evolution-of-mona-lisa/">Genetic Programming: Evolution of Mona Lisa</a>. Since seeing that article when it was quite new, I've tinkered with this problem here and there over the years. But only now am I satisfied with my results.</p>
<p>It should be noted that there are significant differences in my implementation compared to Roger's original work. Mine is not a genetic algorithm. Mine only operates on one shape at a time. Mine is much faster (AFAIK) and supports many types of shapes.</p>
<h2><a class="anchor" id="autotoc_md14"></a>
Examples</h2>
<p>Here are more examples from interesting photos found on Flickr.</p>
<p><img src="https://www.michaelfogleman.com/static/primitive/examples/29167683201.png" alt="Example" class="inline"/> <img src="https://www.michaelfogleman.com/static/primitive/examples/26574286221.200.128.4.1.png" alt="Example" class="inline"/> <img src="https://www.michaelfogleman.com/static/primitive/examples/15011768709.200.128.4.1.png" alt="Example" class="inline"/> <img src="https://www.michaelfogleman.com/static/primitive/examples/27540729075.200.128.4.1.png" alt="Example" class="inline"/> <img src="https://www.michaelfogleman.com/static/primitive/examples/28896874003.png" alt="Example" class="inline"/> <img src="https://www.michaelfogleman.com/static/primitive/examples/20414282102.png" alt="Example" class="inline"/> <img src="https://www.michaelfogleman.com/static/primitive/examples/15199237095.200.128.4.1.png" alt="Example" class="inline"/> <img src="https://www.michaelfogleman.com/static/primitive/examples/11707819764.200.128.4.1.png" alt="Example" class="inline"/> <img src="https://www.michaelfogleman.com/static/primitive/examples/18270231645.200.128.4.3.png" alt="Example" class="inline"/> <img src="https://www.michaelfogleman.com/static/primitive/examples/15705764893.png" alt="Example" class="inline"/> <img src="https://www.michaelfogleman.com/static/primitive/examples/25213252889.png" alt="Example" class="inline"/> <img src="https://www.michaelfogleman.com/static/primitive/examples/15015411870.200.128.4.3.png" alt="Example" class="inline"/> <img src="https://www.michaelfogleman.com/static/primitive/examples/25766500104.png" alt="Example" class="inline"/> <img src="https://www.michaelfogleman.com/static/primitive/examples/27471731151.50.128.4.1.png" alt="Example" class="inline"/> <img src="https://www.michaelfogleman.com/static/primitive/examples/11720700033.200.128.4.3.png" alt="Example" class="inline"/> <img src="https://www.michaelfogleman.com/static/primitive/examples/18782606664.png" alt="Example" class="inline"/> <img src="https://www.michaelfogleman.com/static/primitive/examples/21374478713.png" alt="Example" class="inline"/> <img src="https://www.michaelfogleman.com/static/primitive/examples/15196426112.200.128.4.5.png" alt="Example" class="inline"/> <img src="https://www.michaelfogleman.com/static/primitive/examples/24696847962.png" alt="Example" class="inline"/> <img src="https://www.michaelfogleman.com/static/primitive/examples/18276676312.100.128.4.1.png" alt="Example" class="inline"/> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
